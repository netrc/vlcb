extends layout

block pagecontent
  div.row
    div.span2
      b.pageHead Churches
    div.span3
      form.form-inline(method="post")
        input.input-small(type="text",name="rn",placeholder="search")
        button.btn(type="submit") Search
    div.span3
      form.form-inline(method="post")
        input.input-small(type="text",name="rn",placeholder="sort")
        button.btn(type="submit") Sort
    div.span4
      form.form-inline(method="post")
        input.input-small(type="text",name="cn",placeholder="Church Name")
        input.input-small(type="text",name="ca",placeholder="Address")
        button.btn(type="submit"): i.icon-plus-sign

  div.row
    div.span5
      ul#churchList.nav.nav-pills.nav-stacked
    div.span7
      div#churchShow.well.fixMe
        div#churchShowTitle ...select a church
        div#churchShowPics
        div#churchShowInfo
        div#churchShowBrasses

block pagescript
  script
    $(document).ready(function() {
      $.get("/rest/Church/","",function(d,tstatus,jxhr) {
        //alert("c2b: got churches: "+d.length);
        for (var i=0;i<d.length;i++) { 
            c = d[i];
            cButtId = "cButtId"+i;
            cButtIdRef = "#"+cButtId;
            newLi  = "<li> <button id=\""+cButtId+"\"> "+c.name+"<i> - "+c.address+"</i></button></li>\n";
            $("#churchList").append(newLi);
            $(cButtIdRef).on( 'click', (function(zc) { return function(){churchShow(zc); } })(c) );
        };
        if (d.length>0) {
            churchShow( d[0] );
        };
      } );
    });

    var churchShow = function ( c ) {
        //alert("new cshow: "+c.name);

        $("#churchShowTitle").html("<b>" + c.name + "</b> <i> - " + c.address + "</i>");
        $("#churchShowPics").html("<i> no pics yet </i> <p>");
        $("#churchShowInfo").html("year: " + c.year + " latlon: " + c.latlon +"<p>");
        $("#churchShowBrasses").html("<i> no brasses found </i> <p>");

        $.get("/rest/Church/"+c.name+"/Pic","",function(d,tstatus,jxhr) {
            if (d.length==0) {
                return;
            };
            pStr = "";
            for (var i=0;i<d.length;i++) { 
                p = d[i];
                pStr = pStr + "<img src=\"" + p.thumb + "\"> <p>";
            };
            $("#churchShowPics").html( pStr  );
        } );

        $.get("/rest/Church/"+c.name+"/Brass","",function(d,tstatus,jxhr) {
            //alert("cbr length: " + d.length);
            if (d.length==0) {
                return;
            };
            bStr = "";
            for (var i=0;i<d.length;i++) { 
                b = d[i];
                bStr = bStr + " <a href=\"//brass/\">" + b.name + "</a>" + (((i+1)<d.length) ? ", " : "");
            };
            $("#churchShowBrasses").html( bStr );
        } );
    }